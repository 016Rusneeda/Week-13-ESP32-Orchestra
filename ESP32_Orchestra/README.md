# ESP32 Orchestra Conductor & Musicians
## р╕зр╕Зр╕Фр╕Щр╕Хр╕гр╕╡р╕Ыр╕гр╕░р╕кр╕▓р╕Щр╣Ар╕кр╕╡р╕вр╕Зр╕Фр╣Йр╕зр╕в ESP32, Buzzer р╣Бр╕ер╕░ ESP-NOW

р╣Вр╕Ыр╕гр╣Ар╕Ир╕Др╕Щр╕╡р╣Йр╕Ир╕░р╕кр╕гр╣Йр╕▓р╕Зр╕зр╕Зр╕Фр╕Щр╕Хр╕гр╕╡р╕Чр╕╡р╣Ир╕Ыр╕гр╕░р╕Бр╕нр╕Ър╕Фр╣Йр╕зр╕в:
- **1 Conductor (р╕Ьр╕╣р╣Йр╕Ър╕▒р╕Зр╕Др╕▒р╕Ър╕Бр╕▓р╕г)** - р╕Др╕зр╕Ър╕Др╕╕р╕бр╕Бр╕▓р╕гр╣Ар╕ер╣Ир╕Щр╣Ар╕Юр╕ер╕Зр╣Бр╕ер╕░р╕кр╣Ир╕Зр╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Ьр╣Ир╕▓р╕Щ ESP-NOW
- **р╕лр╕ер╕▓р╕в Musicians (р╕Щр╕▒р╕Бр╕Фр╕Щр╕Хр╕гр╕╡)** - р╕гр╕▒р╕Ър╕Др╕│р╕кр╕▒р╣Ир╕Зр╣Бр╕ер╕░р╣Ар╕ер╣Ир╕Щр╣Ар╕кр╕╡р╕вр╕Зр╕Ыр╕гр╕░р╕кр╕▓р╕Щр╕Бр╕▒р╕Щ

## ЁЯО╡ р╕зр╕┤р╕Шр╕╡р╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щ

### Architecture
```
    Conductor ESP32 (Master)
    тФЬтФАтФА MIDI Parser
    тФЬтФАтФА ESP-NOW Broadcaster  
    тФФтФАтФА р╣Ар╕Юр╕ер╕Зр╣Бр╕Ър╣Ир╕Зр╣Ар╕Ыр╣Зр╕Щ Parts
            |
    тФМтФАтФАтФАтФАтФАтФАтФАтФ╝тФАтФАтФАтФАтФАтФАтФАтФР
    тФВ       тФВ       тФВ
Musician1 Musician2 Musician3
(Part A)  (Part B)  (Part C)
```

### Communication Protocol
1. **Conductor** р╣Бр╕Ыр╕ер╕Зр╣Др╕Яр╕ер╣М MIDI р╣Ар╕Ыр╣Зр╕Щ parts р╣Бр╕вр╕Бр╕Бр╕▒р╕Щ
2. р╕кр╣Ир╕Зр╕Др╕│р╕кр╕▒р╣Ир╕З `START_SONG`, `PLAY_NOTE`, `STOP_NOTE`, `END_SONG` р╕Ьр╣Ир╕▓р╕Щ ESP-NOW
3. **Musicians** р╕гр╕▒р╕Ър╕Др╕│р╕кр╕▒р╣Ир╕Зр╣Бр╕ер╕░р╣Ар╕ер╣Ир╕Щр╣Ар╕кр╕╡р╕вр╕Зр╕Хр╕▓р╕б part р╕Вр╕нр╕Зр╕Хр╕▒р╕зр╣Ар╕нр╕З

## ЁЯО╝ р╣Ар╕Юр╕ер╕Зр╕Чр╕╡р╣Ир╕гр╕нр╕Зр╕гр╕▒р╕Ъ

### 1. Twinkle Twinkle Little Star (4 Parts)
- **Part A (Melody)**: р╣Вр╕Щр╣Кр╕Хр╕лр╕ер╕▒р╕Б
- **Part B (Harmony)**: р╣Ар╕кр╕╡р╕вр╕Зр╕Ыр╕гр╕░р╕кр╕▓р╕Щ
- **Part C (Bass)**: р╣Ар╕кр╕╡р╕вр╕Зр╣Ар╕Ър╕к
- **Part D (Rhythm)**: р╕Ир╕▒р╕Зр╕лр╕зр╕░

### 2. Happy Birthday (3 Parts)  
- **Part A (Melody)**: р╣Ар╕кр╕╡р╕вр╕Зр╕Щр╕│
- **Part B (Harmony)**: р╣Ар╕кр╕╡р╕вр╕Зр╕Ыр╕гр╕░р╕кр╕▓р╕Щ
- **Part C (Bass)**: р╣Ар╕кр╕╡р╕вр╕Зр╣Ар╕Ър╕к

### 3. Canon in D (4 Parts)
- **Part A**: Voice 1
- **Part B**: Voice 2  
- **Part C**: Voice 3
- **Part D**: Voice 4

## ЁЯФз р╕ор╕▓р╕гр╣Мр╕Фр╣Бр╕зр╕гр╣М

### Conductor (1 р╕Хр╕▒р╕з)
- ESP32 Development Board
- LED р╣Бр╕кр╕Фр╕Зр╕кр╕Цр╕▓р╕Щр╕░ (GPIO 2)
- Push Button р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Ар╕ер╕╖р╕нр╕Бр╣Ар╕Юр╕ер╕З (GPIO 0)

### Musicians (3-4 р╕Хр╕▒р╕з)
- ESP32 Development Board р╣Бр╕Хр╣Ир╕ер╕░р╕Хр╕▒р╕з
- Buzzer р╕лр╕гр╕╖р╕н Small Speaker (GPIO 18)
- LED р╣Бр╕кр╕Фр╕Зр╕кр╕Цр╕▓р╕Щр╕░ (GPIO 2)
- Resistor 220╬й (р╕Цр╣Йр╕▓р╣Гр╕Кр╣Й Speaker)

## ЁЯФЧ р╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н

### Conductor
```
ESP32 Conductor    Component
GPIO 2      ----> LED (Status)
GPIO 0      ----> Push Button (Song Select)
GND         ----> Common Ground
```

### Musicians
```
ESP32 Musician     Component
GPIO 18     ----> Buzzer/Speaker (+)
GPIO 2      ----> LED (Status)
GND         ----> Buzzer/Speaker (-) & LED (-)
```

## ЁЯУб ESP-NOW Communication

### Message Types
```cpp
typedef enum {
    MSG_SONG_START = 1,     // р╣Ар╕гр╕┤р╣Ир╕бр╣Ар╕Юр╕ер╕З
    MSG_PLAY_NOTE = 2,      // р╣Ар╕ер╣Ир╕Щр╣Вр╕Щр╣Кр╕Х
    MSG_STOP_NOTE = 3,      // р╕лр╕вр╕╕р╕Фр╣Вр╕Щр╣Кр╕Х  
    MSG_SONG_END = 4,       // р╕Ир╕Ър╣Ар╕Юр╕ер╕З
    MSG_SYNC_TIME = 5       // р╕Лр╕┤р╕Зр╕Др╣Мр╣Ар╕зр╕ер╕▓
} message_type_t;

typedef struct {
    message_type_t type;
    uint8_t song_id;        // р╕гр╕лр╕▒р╕кр╣Ар╕Юр╕ер╕З
    uint8_t part_id;        // Part A, B, C, D (0-3)
    uint8_t note;           // MIDI Note (0-127)
    uint8_t velocity;       // р╕Др╕зр╕▓р╕бр╣Бр╕гр╕З (0-127)
    uint32_t timestamp;     // р╣Ар╕зр╕ер╕▓р╣Гр╕Щр╕Бр╕▓р╕гр╣Ар╕ер╣Ир╕Щ
    uint16_t duration_ms;   // р╕Др╕зр╕▓р╕бр╕вр╕▓р╕зр╣Вр╕Щр╣Кр╕Х
} orchestra_message_t;
```

### Broadcasting Strategy
- р╣Гр╕Кр╣Й **Broadcast Address** `FF:FF:FF:FF:FF:FF`
- Musicians р╕Бр╕гр╕нр╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Хр╕▓р╕б `part_id` р╕Вр╕нр╕Зр╕Хр╕▒р╕зр╣Ар╕нр╕З
- Timestamp synchronization р╣Ар╕Юр╕╖р╣Ир╕нр╣Ар╕ер╣Ир╕Щр╕Юр╕гр╣Йр╕нр╕бр╕Бр╕▒р╕Щ

## ЁЯЪА р╕зр╕┤р╕Шр╕╡р╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ

### 1. Setup Musicians
1. Flash р╣Вр╕Др╣Йр╕Ф `musician.ino` р╕ер╕Зр╣Гр╕Щ ESP32 р╣Бр╕Хр╣Ир╕ер╕░р╕Хр╕▒р╕з
2. р╕Бр╕│р╕лр╕Щр╕Ф `MUSICIAN_ID` (0, 1, 2, 3) р╣Гр╕лр╣Йр╕Хр╣Ир╕▓р╕Зр╕Бр╕▒р╕Щр╣Гр╕Щр╣Бр╕Хр╣Ир╕ер╕░р╕Хр╕▒р╕з
3. р╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н Buzzer р╕Бр╕▒р╕Ъ GPIO 18

### 2. Setup Conductor  
1. Flash р╣Вр╕Др╣Йр╕Ф `conductor.ino` р╕ер╕Зр╣Гр╕Щ ESP32
2. р╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н Push Button р╕Бр╕▒р╕Ъ GPIO 0
3. р╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н LED р╕Бр╕▒р╕Ъ GPIO 2

### 3. р╕Бр╕▓р╕гр╣Ар╕ер╣Ир╕Щ
1. р╣Ар╕Ыр╕┤р╕Ф Musicians р╕Чр╕╕р╕Бр╕Хр╕▒р╕зр╕Бр╣Ир╕нр╕Щ (LED р╕Ир╕░р╕Бр╕гр╕░р╕Юр╕гр╕┤р╕Ър╣Бр╕кр╕Фр╕Зр╕зр╣Ир╕▓р╕Юр╕гр╣Йр╕нр╕б)
2. р╣Ар╕Ыр╕┤р╕Ф Conductor 
3. р╕Бр╕Ф Button р╕Ър╕Щ Conductor р╣Ар╕Юр╕╖р╣Ир╕нр╣Ар╕ер╕╖р╕нр╕Бр╣Ар╕Юр╕ер╕З
4. Conductor р╕Ир╕░р╕кр╣Ир╕Зр╕кр╕▒р╕Нр╕Нр╕▓р╕Ур╣Ар╕гр╕┤р╣Ир╕бр╣Ар╕Юр╕ер╕З
5. Musicians р╕Ир╕░р╣Ар╕ер╣Ир╕Щр╣Ар╕кр╕╡р╕вр╕Зр╕Ыр╕гр╕░р╕кр╕▓р╕Щр╕Бр╕▒р╕Щ

## ЁЯУБ р╣Вр╕Др╕гр╕Зр╕кр╕гр╣Йр╕▓р╕Зр╣Др╕Яр╕ер╣М

```
ESP32_Orchestra/
тФЬтФАтФА README.md
тФЬтФАтФА conductor/                 # р╣Вр╕Др╣Йр╕Фр╕кр╕│р╕лр╕гр╕▒р╕Ъ Conductor
тФВ   тФЬтФАтФА conductor.ino
тФВ   тФЬтФАтФА midi_songs.h          # р╣Ар╕Юр╕ер╕З MIDI р╕Чр╕╡р╣Ир╣Бр╕Ыр╕ер╕Зр╣Бр╕ер╣Йр╕з
тФВ   тФЬтФАтФА espnow_conductor.h    # ESP-NOW Communication
тФВ   тФФтФАтФА orchestra_common.h    # Common definitions
тФЬтФАтФА musician/                 # р╣Вр╕Др╣Йр╕Фр╕кр╕│р╕лр╕гр╕▒р╕Ъ Musicians  
тФВ   тФЬтФАтФА musician.ino
тФВ   тФЬтФАтФА sound_player.h        # Sound generation
тФВ   тФЬтФАтФА espnow_musician.h     # ESP-NOW Communication
тФВ   тФФтФАтФА orchestra_common.h    # Common definitions
тФЬтФАтФА songs/                    # р╣Ар╕Юр╕ер╕Зр╕Хр╣Йр╕Щр╕Йр╕Ър╕▒р╕Ъ
тФВ   тФЬтФАтФА twinkle_star_4parts.mid
тФВ   тФЬтФАтФА happy_birthday_3parts.mid
тФВ   тФФтФАтФА canon_in_d_4parts.mid
тФФтФАтФА tools/
    тФФтФАтФА midi_to_orchestra.py  # р╣Бр╕Ыр╕ер╕З MIDI р╣Ар╕Ыр╣Зр╕Щ Orchestra format
```

## ЁЯОп р╕Бр╕▓р╕гр╣Ар╕гр╕╡р╕вр╕Щр╕гр╕╣р╣Й

р╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щр╕Ир╕░р╣Др╕Фр╣Йр╣Ар╕гр╕╡р╕вр╕Щр╕гр╕╣р╣Й:
1. **MIDI Processing** - р╕Бр╕▓р╕гр╣Бр╕Ыр╕ер╕Зр╣Др╕Яр╕ер╣Мр╣Ар╕кр╕╡р╕вр╕Зр╣Ар╕Ыр╣Зр╕Щр╣Вр╕Щр╣Кр╕Х
2. **ESP-NOW Broadcasting** - р╕Бр╕▓р╕гр╕кр╕╖р╣Ир╕нр╕кр╕▓р╕гр╣Бр╕Ър╕Ъ One-to-Many
3. **Time Synchronization** - р╕Бр╕▓р╕гр╣Ар╕ер╣Ир╕Щр╣Ар╕Юр╕ер╕Зр╣Гр╕лр╣Йр╕Ыр╕гр╕░р╕кр╕▓р╕Щр╕Бр╕▒р╕Щ
4. **Embedded Systems** - р╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щр╕гр╣Ир╕зр╕бр╕Бр╕▒р╕Щр╕Вр╕нр╕Зр╕лр╕ер╕▓р╕в MCU
5. **Digital Music** - р╕лр╕ер╕▒р╕Бр╕Бр╕▓р╕гр╣Ар╕кр╕╡р╕вр╕Зр╕Фр╕Щр╕Хр╕гр╕╡р╕Фр╕┤р╕Ир╕┤р╕Чр╕▒р╕е

## ЁЯФз Troubleshooting

### р╕Ыр╕▒р╕Нр╕лр╕▓р╕Чр╕╡р╣Ир╕Юр╕Ър╕Ър╣Ир╕нр╕в
1. **Musicians р╣Др╕бр╣Ир╕гр╕▒р╕Ър╕кр╕▒р╕Нр╕Нр╕▓р╕У** - р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ ESP-NOW setup
2. **р╣Ар╕кр╕╡р╕вр╕Зр╣Др╕бр╣Ир╕Ыр╕гр╕░р╕кр╕▓р╕Щ** - р╕Ыр╕гр╕▒р╕Ъ timestamp synchronization  
3. **Buzzer р╣Ар╕кр╕╡р╕вр╕Зр╣Ар╕Ър╕▓** - р╣Ар╕Кр╣Зр╕Др╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╣Бр╕ер╕░ PWM settings
4. **р╕Бр╕▓р╕гр╕Хр╕нр╕Ър╕кр╕Щр╕нр╕Зр╕ер╣Ир╕▓р╕Кр╣Йр╕▓** - р╕ер╕Ф delay р╣Гр╕Щ main loop

### Debug Tips
- р╣Гр╕Кр╣Й Serial Monitor р╕Фр╕╣ ESP-NOW messages
- LED р╕Бр╕гр╕░р╕Юр╕гр╕┤р╕Ър╣Бр╕кр╕Фр╕Зр╕кр╕Цр╕▓р╕Щр╕░р╕Бр╕▓р╕гр╕гр╕▒р╕Ър╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е
- р╕Чр╕Фр╕кр╕нр╕Ър╕Чр╕╡р╕ер╕░ Musician р╕Бр╣Ир╕нр╕Щр╣Ар╕ер╣Ир╕Щр╣Бр╕Ър╕Ъ full orchestra

---

## ЁЯО╡ "р╣Гр╕лр╣Йр╣Ар╕кр╕╡р╕вр╕Зр╕Фр╕Щр╕Хр╕гр╕╡р╣Ар╕Бр╕┤р╕Фр╕Ир╕▓р╕Бр╕Др╕зр╕▓р╕бр╕гр╣Ир╕зр╕бр╕бр╕╖р╕н р╣Др╕бр╣Ир╣Гр╕Кр╣Ир╣Бр╕Др╣И ESP32 р╕Хр╕▒р╕зр╣Ар╕Фр╕╡р╕вр╕з!"